revoke delete on table "public"."basic_sponsor_companies" from "anon";

revoke insert on table "public"."basic_sponsor_companies" from "anon";

revoke references on table "public"."basic_sponsor_companies" from "anon";

revoke select on table "public"."basic_sponsor_companies" from "anon";

revoke trigger on table "public"."basic_sponsor_companies" from "anon";

revoke truncate on table "public"."basic_sponsor_companies" from "anon";

revoke update on table "public"."basic_sponsor_companies" from "anon";

revoke delete on table "public"."basic_sponsor_companies" from "authenticated";

revoke insert on table "public"."basic_sponsor_companies" from "authenticated";

revoke references on table "public"."basic_sponsor_companies" from "authenticated";

revoke select on table "public"."basic_sponsor_companies" from "authenticated";

revoke trigger on table "public"."basic_sponsor_companies" from "authenticated";

revoke truncate on table "public"."basic_sponsor_companies" from "authenticated";

revoke update on table "public"."basic_sponsor_companies" from "authenticated";

revoke delete on table "public"."basic_sponsor_companies" from "service_role";

revoke insert on table "public"."basic_sponsor_companies" from "service_role";

revoke references on table "public"."basic_sponsor_companies" from "service_role";

revoke select on table "public"."basic_sponsor_companies" from "service_role";

revoke trigger on table "public"."basic_sponsor_companies" from "service_role";

revoke truncate on table "public"."basic_sponsor_companies" from "service_role";

revoke update on table "public"."basic_sponsor_companies" from "service_role";

revoke delete on table "public"."companies" from "anon";

revoke insert on table "public"."companies" from "anon";

revoke references on table "public"."companies" from "anon";

revoke select on table "public"."companies" from "anon";

revoke trigger on table "public"."companies" from "anon";

revoke truncate on table "public"."companies" from "anon";

revoke update on table "public"."companies" from "anon";

revoke delete on table "public"."companies" from "authenticated";

revoke insert on table "public"."companies" from "authenticated";

revoke references on table "public"."companies" from "authenticated";

revoke select on table "public"."companies" from "authenticated";

revoke trigger on table "public"."companies" from "authenticated";

revoke truncate on table "public"."companies" from "authenticated";

revoke update on table "public"."companies" from "authenticated";

revoke delete on table "public"."companies" from "service_role";

revoke insert on table "public"."companies" from "service_role";

revoke references on table "public"."companies" from "service_role";

revoke select on table "public"."companies" from "service_role";

revoke trigger on table "public"."companies" from "service_role";

revoke truncate on table "public"."companies" from "service_role";

revoke update on table "public"."companies" from "service_role";

revoke delete on table "public"."company_draft_approvals" from "anon";

revoke insert on table "public"."company_draft_approvals" from "anon";

revoke references on table "public"."company_draft_approvals" from "anon";

revoke select on table "public"."company_draft_approvals" from "anon";

revoke trigger on table "public"."company_draft_approvals" from "anon";

revoke truncate on table "public"."company_draft_approvals" from "anon";

revoke update on table "public"."company_draft_approvals" from "anon";

revoke delete on table "public"."company_draft_approvals" from "authenticated";

revoke insert on table "public"."company_draft_approvals" from "authenticated";

revoke references on table "public"."company_draft_approvals" from "authenticated";

revoke select on table "public"."company_draft_approvals" from "authenticated";

revoke trigger on table "public"."company_draft_approvals" from "authenticated";

revoke truncate on table "public"."company_draft_approvals" from "authenticated";

revoke update on table "public"."company_draft_approvals" from "authenticated";

revoke delete on table "public"."company_draft_approvals" from "service_role";

revoke insert on table "public"."company_draft_approvals" from "service_role";

revoke references on table "public"."company_draft_approvals" from "service_role";

revoke select on table "public"."company_draft_approvals" from "service_role";

revoke trigger on table "public"."company_draft_approvals" from "service_role";

revoke truncate on table "public"."company_draft_approvals" from "service_role";

revoke update on table "public"."company_draft_approvals" from "service_role";

revoke delete on table "public"."company_drafts" from "anon";

revoke insert on table "public"."company_drafts" from "anon";

revoke references on table "public"."company_drafts" from "anon";

revoke select on table "public"."company_drafts" from "anon";

revoke trigger on table "public"."company_drafts" from "anon";

revoke truncate on table "public"."company_drafts" from "anon";

revoke update on table "public"."company_drafts" from "anon";

revoke delete on table "public"."company_drafts" from "authenticated";

revoke insert on table "public"."company_drafts" from "authenticated";

revoke references on table "public"."company_drafts" from "authenticated";

revoke select on table "public"."company_drafts" from "authenticated";

revoke trigger on table "public"."company_drafts" from "authenticated";

revoke truncate on table "public"."company_drafts" from "authenticated";

revoke update on table "public"."company_drafts" from "authenticated";

revoke delete on table "public"."company_drafts" from "service_role";

revoke insert on table "public"."company_drafts" from "service_role";

revoke references on table "public"."company_drafts" from "service_role";

revoke select on table "public"."company_drafts" from "service_role";

revoke trigger on table "public"."company_drafts" from "service_role";

revoke truncate on table "public"."company_drafts" from "service_role";

revoke update on table "public"."company_drafts" from "service_role";

revoke delete on table "public"."company_invitation" from "anon";

revoke insert on table "public"."company_invitation" from "anon";

revoke references on table "public"."company_invitation" from "anon";

revoke select on table "public"."company_invitation" from "anon";

revoke trigger on table "public"."company_invitation" from "anon";

revoke truncate on table "public"."company_invitation" from "anon";

revoke update on table "public"."company_invitation" from "anon";

revoke delete on table "public"."company_invitation" from "authenticated";

revoke insert on table "public"."company_invitation" from "authenticated";

revoke references on table "public"."company_invitation" from "authenticated";

revoke select on table "public"."company_invitation" from "authenticated";

revoke trigger on table "public"."company_invitation" from "authenticated";

revoke truncate on table "public"."company_invitation" from "authenticated";

revoke update on table "public"."company_invitation" from "authenticated";

revoke delete on table "public"."company_invitation" from "service_role";

revoke insert on table "public"."company_invitation" from "service_role";

revoke references on table "public"."company_invitation" from "service_role";

revoke select on table "public"."company_invitation" from "service_role";

revoke trigger on table "public"."company_invitation" from "service_role";

revoke truncate on table "public"."company_invitation" from "service_role";

revoke update on table "public"."company_invitation" from "service_role";

revoke delete on table "public"."company_members" from "anon";

revoke insert on table "public"."company_members" from "anon";

revoke references on table "public"."company_members" from "anon";

revoke select on table "public"."company_members" from "anon";

revoke trigger on table "public"."company_members" from "anon";

revoke truncate on table "public"."company_members" from "anon";

revoke update on table "public"."company_members" from "anon";

revoke delete on table "public"."company_members" from "authenticated";

revoke insert on table "public"."company_members" from "authenticated";

revoke references on table "public"."company_members" from "authenticated";

revoke select on table "public"."company_members" from "authenticated";

revoke trigger on table "public"."company_members" from "authenticated";

revoke truncate on table "public"."company_members" from "authenticated";

revoke update on table "public"."company_members" from "authenticated";

revoke delete on table "public"."company_members" from "service_role";

revoke insert on table "public"."company_members" from "service_role";

revoke references on table "public"."company_members" from "service_role";

revoke select on table "public"."company_members" from "service_role";

revoke trigger on table "public"."company_members" from "service_role";

revoke truncate on table "public"."company_members" from "service_role";

revoke update on table "public"."company_members" from "service_role";

revoke delete on table "public"."device_apns_live_activity_tokens" from "anon";

revoke insert on table "public"."device_apns_live_activity_tokens" from "anon";

revoke references on table "public"."device_apns_live_activity_tokens" from "anon";

revoke select on table "public"."device_apns_live_activity_tokens" from "anon";

revoke trigger on table "public"."device_apns_live_activity_tokens" from "anon";

revoke truncate on table "public"."device_apns_live_activity_tokens" from "anon";

revoke update on table "public"."device_apns_live_activity_tokens" from "anon";

revoke delete on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke insert on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke references on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke select on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke trigger on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke truncate on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke update on table "public"."device_apns_live_activity_tokens" from "authenticated";

revoke delete on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke insert on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke references on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke select on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke trigger on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke truncate on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke update on table "public"."device_apns_live_activity_tokens" from "service_role";

revoke delete on table "public"."device_apns_tokens" from "anon";

revoke insert on table "public"."device_apns_tokens" from "anon";

revoke references on table "public"."device_apns_tokens" from "anon";

revoke select on table "public"."device_apns_tokens" from "anon";

revoke trigger on table "public"."device_apns_tokens" from "anon";

revoke truncate on table "public"."device_apns_tokens" from "anon";

revoke update on table "public"."device_apns_tokens" from "anon";

revoke delete on table "public"."device_apns_tokens" from "authenticated";

revoke insert on table "public"."device_apns_tokens" from "authenticated";

revoke references on table "public"."device_apns_tokens" from "authenticated";

revoke select on table "public"."device_apns_tokens" from "authenticated";

revoke trigger on table "public"."device_apns_tokens" from "authenticated";

revoke truncate on table "public"."device_apns_tokens" from "authenticated";

revoke update on table "public"."device_apns_tokens" from "authenticated";

revoke delete on table "public"."device_apns_tokens" from "service_role";

revoke insert on table "public"."device_apns_tokens" from "service_role";

revoke references on table "public"."device_apns_tokens" from "service_role";

revoke select on table "public"."device_apns_tokens" from "service_role";

revoke trigger on table "public"."device_apns_tokens" from "service_role";

revoke truncate on table "public"."device_apns_tokens" from "service_role";

revoke update on table "public"."device_apns_tokens" from "service_role";

revoke delete on table "public"."device_fcm_tokens" from "anon";

revoke insert on table "public"."device_fcm_tokens" from "anon";

revoke references on table "public"."device_fcm_tokens" from "anon";

revoke select on table "public"."device_fcm_tokens" from "anon";

revoke trigger on table "public"."device_fcm_tokens" from "anon";

revoke truncate on table "public"."device_fcm_tokens" from "anon";

revoke update on table "public"."device_fcm_tokens" from "anon";

revoke delete on table "public"."device_fcm_tokens" from "authenticated";

revoke insert on table "public"."device_fcm_tokens" from "authenticated";

revoke references on table "public"."device_fcm_tokens" from "authenticated";

revoke select on table "public"."device_fcm_tokens" from "authenticated";

revoke trigger on table "public"."device_fcm_tokens" from "authenticated";

revoke truncate on table "public"."device_fcm_tokens" from "authenticated";

revoke update on table "public"."device_fcm_tokens" from "authenticated";

revoke delete on table "public"."device_fcm_tokens" from "service_role";

revoke insert on table "public"."device_fcm_tokens" from "service_role";

revoke references on table "public"."device_fcm_tokens" from "service_role";

revoke select on table "public"."device_fcm_tokens" from "service_role";

revoke trigger on table "public"."device_fcm_tokens" from "service_role";

revoke truncate on table "public"."device_fcm_tokens" from "service_role";

revoke update on table "public"."device_fcm_tokens" from "service_role";

revoke delete on table "public"."devices" from "anon";

revoke insert on table "public"."devices" from "anon";

revoke references on table "public"."devices" from "anon";

revoke select on table "public"."devices" from "anon";

revoke trigger on table "public"."devices" from "anon";

revoke truncate on table "public"."devices" from "anon";

revoke update on table "public"."devices" from "anon";

revoke delete on table "public"."devices" from "authenticated";

revoke insert on table "public"."devices" from "authenticated";

revoke references on table "public"."devices" from "authenticated";

revoke select on table "public"."devices" from "authenticated";

revoke trigger on table "public"."devices" from "authenticated";

revoke truncate on table "public"."devices" from "authenticated";

revoke update on table "public"."devices" from "authenticated";

revoke delete on table "public"."devices" from "service_role";

revoke insert on table "public"."devices" from "service_role";

revoke references on table "public"."devices" from "service_role";

revoke select on table "public"."devices" from "service_role";

revoke trigger on table "public"."devices" from "service_role";

revoke truncate on table "public"."devices" from "service_role";

revoke update on table "public"."devices" from "service_role";

revoke delete on table "public"."individual_draft_approvals" from "anon";

revoke insert on table "public"."individual_draft_approvals" from "anon";

revoke references on table "public"."individual_draft_approvals" from "anon";

revoke select on table "public"."individual_draft_approvals" from "anon";

revoke trigger on table "public"."individual_draft_approvals" from "anon";

revoke truncate on table "public"."individual_draft_approvals" from "anon";

revoke update on table "public"."individual_draft_approvals" from "anon";

revoke delete on table "public"."individual_draft_approvals" from "authenticated";

revoke insert on table "public"."individual_draft_approvals" from "authenticated";

revoke references on table "public"."individual_draft_approvals" from "authenticated";

revoke select on table "public"."individual_draft_approvals" from "authenticated";

revoke trigger on table "public"."individual_draft_approvals" from "authenticated";

revoke truncate on table "public"."individual_draft_approvals" from "authenticated";

revoke update on table "public"."individual_draft_approvals" from "authenticated";

revoke delete on table "public"."individual_draft_approvals" from "service_role";

revoke insert on table "public"."individual_draft_approvals" from "service_role";

revoke references on table "public"."individual_draft_approvals" from "service_role";

revoke select on table "public"."individual_draft_approvals" from "service_role";

revoke trigger on table "public"."individual_draft_approvals" from "service_role";

revoke truncate on table "public"."individual_draft_approvals" from "service_role";

revoke update on table "public"."individual_draft_approvals" from "service_role";

revoke delete on table "public"."individual_drafts" from "anon";

revoke insert on table "public"."individual_drafts" from "anon";

revoke references on table "public"."individual_drafts" from "anon";

revoke select on table "public"."individual_drafts" from "anon";

revoke trigger on table "public"."individual_drafts" from "anon";

revoke truncate on table "public"."individual_drafts" from "anon";

revoke update on table "public"."individual_drafts" from "anon";

revoke delete on table "public"."individual_drafts" from "authenticated";

revoke insert on table "public"."individual_drafts" from "authenticated";

revoke references on table "public"."individual_drafts" from "authenticated";

revoke select on table "public"."individual_drafts" from "authenticated";

revoke trigger on table "public"."individual_drafts" from "authenticated";

revoke truncate on table "public"."individual_drafts" from "authenticated";

revoke update on table "public"."individual_drafts" from "authenticated";

revoke delete on table "public"."individual_drafts" from "service_role";

revoke insert on table "public"."individual_drafts" from "service_role";

revoke references on table "public"."individual_drafts" from "service_role";

revoke select on table "public"."individual_drafts" from "service_role";

revoke trigger on table "public"."individual_drafts" from "service_role";

revoke truncate on table "public"."individual_drafts" from "service_role";

revoke update on table "public"."individual_drafts" from "service_role";

revoke delete on table "public"."individuals" from "anon";

revoke insert on table "public"."individuals" from "anon";

revoke references on table "public"."individuals" from "anon";

revoke select on table "public"."individuals" from "anon";

revoke trigger on table "public"."individuals" from "anon";

revoke truncate on table "public"."individuals" from "anon";

revoke update on table "public"."individuals" from "anon";

revoke delete on table "public"."individuals" from "authenticated";

revoke insert on table "public"."individuals" from "authenticated";

revoke references on table "public"."individuals" from "authenticated";

revoke select on table "public"."individuals" from "authenticated";

revoke trigger on table "public"."individuals" from "authenticated";

revoke truncate on table "public"."individuals" from "authenticated";

revoke update on table "public"."individuals" from "authenticated";

revoke delete on table "public"."individuals" from "service_role";

revoke insert on table "public"."individuals" from "service_role";

revoke references on table "public"."individuals" from "service_role";

revoke select on table "public"."individuals" from "service_role";

revoke trigger on table "public"."individuals" from "service_role";

revoke truncate on table "public"."individuals" from "service_role";

revoke update on table "public"."individuals" from "service_role";

revoke delete on table "public"."job_boards" from "anon";

revoke insert on table "public"."job_boards" from "anon";

revoke references on table "public"."job_boards" from "anon";

revoke select on table "public"."job_boards" from "anon";

revoke trigger on table "public"."job_boards" from "anon";

revoke truncate on table "public"."job_boards" from "anon";

revoke update on table "public"."job_boards" from "anon";

revoke delete on table "public"."job_boards" from "authenticated";

revoke insert on table "public"."job_boards" from "authenticated";

revoke references on table "public"."job_boards" from "authenticated";

revoke select on table "public"."job_boards" from "authenticated";

revoke trigger on table "public"."job_boards" from "authenticated";

revoke truncate on table "public"."job_boards" from "authenticated";

revoke update on table "public"."job_boards" from "authenticated";

revoke delete on table "public"."job_boards" from "service_role";

revoke insert on table "public"."job_boards" from "service_role";

revoke references on table "public"."job_boards" from "service_role";

revoke select on table "public"."job_boards" from "service_role";

revoke trigger on table "public"."job_boards" from "service_role";

revoke truncate on table "public"."job_boards" from "service_role";

revoke update on table "public"."job_boards" from "service_role";

revoke delete on table "public"."news" from "anon";

revoke insert on table "public"."news" from "anon";

revoke references on table "public"."news" from "anon";

revoke select on table "public"."news" from "anon";

revoke trigger on table "public"."news" from "anon";

revoke truncate on table "public"."news" from "anon";

revoke update on table "public"."news" from "anon";

revoke delete on table "public"."news" from "authenticated";

revoke insert on table "public"."news" from "authenticated";

revoke references on table "public"."news" from "authenticated";

revoke select on table "public"."news" from "authenticated";

revoke trigger on table "public"."news" from "authenticated";

revoke truncate on table "public"."news" from "authenticated";

revoke update on table "public"."news" from "authenticated";

revoke delete on table "public"."news" from "service_role";

revoke insert on table "public"."news" from "service_role";

revoke references on table "public"."news" from "service_role";

revoke select on table "public"."news" from "service_role";

revoke trigger on table "public"."news" from "service_role";

revoke truncate on table "public"."news" from "service_role";

revoke update on table "public"."news" from "service_role";

revoke delete on table "public"."profile_share" from "anon";

revoke insert on table "public"."profile_share" from "anon";

revoke references on table "public"."profile_share" from "anon";

revoke select on table "public"."profile_share" from "anon";

revoke trigger on table "public"."profile_share" from "anon";

revoke truncate on table "public"."profile_share" from "anon";

revoke update on table "public"."profile_share" from "anon";

revoke delete on table "public"."profile_share" from "authenticated";

revoke insert on table "public"."profile_share" from "authenticated";

revoke references on table "public"."profile_share" from "authenticated";

revoke select on table "public"."profile_share" from "authenticated";

revoke trigger on table "public"."profile_share" from "authenticated";

revoke truncate on table "public"."profile_share" from "authenticated";

revoke update on table "public"."profile_share" from "authenticated";

revoke delete on table "public"."profile_share" from "service_role";

revoke insert on table "public"."profile_share" from "service_role";

revoke references on table "public"."profile_share" from "service_role";

revoke select on table "public"."profile_share" from "service_role";

revoke trigger on table "public"."profile_share" from "service_role";

revoke truncate on table "public"."profile_share" from "service_role";

revoke update on table "public"."profile_share" from "service_role";

revoke delete on table "public"."profiles" from "anon";

revoke insert on table "public"."profiles" from "anon";

revoke references on table "public"."profiles" from "anon";

revoke select on table "public"."profiles" from "anon";

revoke trigger on table "public"."profiles" from "anon";

revoke truncate on table "public"."profiles" from "anon";

revoke update on table "public"."profiles" from "anon";

revoke delete on table "public"."profiles" from "authenticated";

revoke insert on table "public"."profiles" from "authenticated";

revoke references on table "public"."profiles" from "authenticated";

revoke select on table "public"."profiles" from "authenticated";

revoke trigger on table "public"."profiles" from "authenticated";

revoke truncate on table "public"."profiles" from "authenticated";

revoke update on table "public"."profiles" from "authenticated";

revoke delete on table "public"."profiles" from "service_role";

revoke insert on table "public"."profiles" from "service_role";

revoke references on table "public"."profiles" from "service_role";

revoke select on table "public"."profiles" from "service_role";

revoke trigger on table "public"."profiles" from "service_role";

revoke truncate on table "public"."profiles" from "service_role";

revoke update on table "public"."profiles" from "service_role";

revoke delete on table "public"."session_speakers" from "anon";

revoke insert on table "public"."session_speakers" from "anon";

revoke references on table "public"."session_speakers" from "anon";

revoke select on table "public"."session_speakers" from "anon";

revoke trigger on table "public"."session_speakers" from "anon";

revoke truncate on table "public"."session_speakers" from "anon";

revoke update on table "public"."session_speakers" from "anon";

revoke delete on table "public"."session_speakers" from "authenticated";

revoke insert on table "public"."session_speakers" from "authenticated";

revoke references on table "public"."session_speakers" from "authenticated";

revoke select on table "public"."session_speakers" from "authenticated";

revoke trigger on table "public"."session_speakers" from "authenticated";

revoke truncate on table "public"."session_speakers" from "authenticated";

revoke update on table "public"."session_speakers" from "authenticated";

revoke delete on table "public"."session_speakers" from "service_role";

revoke insert on table "public"."session_speakers" from "service_role";

revoke references on table "public"."session_speakers" from "service_role";

revoke select on table "public"."session_speakers" from "service_role";

revoke trigger on table "public"."session_speakers" from "service_role";

revoke truncate on table "public"."session_speakers" from "service_role";

revoke update on table "public"."session_speakers" from "service_role";

revoke delete on table "public"."session_venues" from "anon";

revoke insert on table "public"."session_venues" from "anon";

revoke references on table "public"."session_venues" from "anon";

revoke select on table "public"."session_venues" from "anon";

revoke trigger on table "public"."session_venues" from "anon";

revoke truncate on table "public"."session_venues" from "anon";

revoke update on table "public"."session_venues" from "anon";

revoke delete on table "public"."session_venues" from "authenticated";

revoke insert on table "public"."session_venues" from "authenticated";

revoke references on table "public"."session_venues" from "authenticated";

revoke select on table "public"."session_venues" from "authenticated";

revoke trigger on table "public"."session_venues" from "authenticated";

revoke truncate on table "public"."session_venues" from "authenticated";

revoke update on table "public"."session_venues" from "authenticated";

revoke delete on table "public"."session_venues" from "service_role";

revoke insert on table "public"."session_venues" from "service_role";

revoke references on table "public"."session_venues" from "service_role";

revoke select on table "public"."session_venues" from "service_role";

revoke trigger on table "public"."session_venues" from "service_role";

revoke truncate on table "public"."session_venues" from "service_role";

revoke update on table "public"."session_venues" from "service_role";

revoke delete on table "public"."sessions" from "anon";

revoke insert on table "public"."sessions" from "anon";

revoke references on table "public"."sessions" from "anon";

revoke select on table "public"."sessions" from "anon";

revoke trigger on table "public"."sessions" from "anon";

revoke truncate on table "public"."sessions" from "anon";

revoke update on table "public"."sessions" from "anon";

revoke delete on table "public"."sessions" from "authenticated";

revoke insert on table "public"."sessions" from "authenticated";

revoke references on table "public"."sessions" from "authenticated";

revoke select on table "public"."sessions" from "authenticated";

revoke trigger on table "public"."sessions" from "authenticated";

revoke truncate on table "public"."sessions" from "authenticated";

revoke update on table "public"."sessions" from "authenticated";

revoke delete on table "public"."sessions" from "service_role";

revoke insert on table "public"."sessions" from "service_role";

revoke references on table "public"."sessions" from "service_role";

revoke select on table "public"."sessions" from "service_role";

revoke trigger on table "public"."sessions" from "service_role";

revoke truncate on table "public"."sessions" from "service_role";

revoke update on table "public"."sessions" from "service_role";

revoke delete on table "public"."speakers" from "anon";

revoke insert on table "public"."speakers" from "anon";

revoke references on table "public"."speakers" from "anon";

revoke select on table "public"."speakers" from "anon";

revoke trigger on table "public"."speakers" from "anon";

revoke truncate on table "public"."speakers" from "anon";

revoke update on table "public"."speakers" from "anon";

revoke delete on table "public"."speakers" from "authenticated";

revoke insert on table "public"."speakers" from "authenticated";

revoke references on table "public"."speakers" from "authenticated";

revoke select on table "public"."speakers" from "authenticated";

revoke trigger on table "public"."speakers" from "authenticated";

revoke truncate on table "public"."speakers" from "authenticated";

revoke update on table "public"."speakers" from "authenticated";

revoke delete on table "public"."speakers" from "service_role";

revoke insert on table "public"."speakers" from "service_role";

revoke references on table "public"."speakers" from "service_role";

revoke select on table "public"."speakers" from "service_role";

revoke trigger on table "public"."speakers" from "service_role";

revoke truncate on table "public"."speakers" from "service_role";

revoke update on table "public"."speakers" from "service_role";

revoke delete on table "public"."sponsor_companies" from "anon";

revoke insert on table "public"."sponsor_companies" from "anon";

revoke references on table "public"."sponsor_companies" from "anon";

revoke select on table "public"."sponsor_companies" from "anon";

revoke trigger on table "public"."sponsor_companies" from "anon";

revoke truncate on table "public"."sponsor_companies" from "anon";

revoke update on table "public"."sponsor_companies" from "anon";

revoke delete on table "public"."sponsor_companies" from "authenticated";

revoke insert on table "public"."sponsor_companies" from "authenticated";

revoke references on table "public"."sponsor_companies" from "authenticated";

revoke select on table "public"."sponsor_companies" from "authenticated";

revoke trigger on table "public"."sponsor_companies" from "authenticated";

revoke truncate on table "public"."sponsor_companies" from "authenticated";

revoke update on table "public"."sponsor_companies" from "authenticated";

revoke delete on table "public"."sponsor_companies" from "service_role";

revoke insert on table "public"."sponsor_companies" from "service_role";

revoke references on table "public"."sponsor_companies" from "service_role";

revoke select on table "public"."sponsor_companies" from "service_role";

revoke trigger on table "public"."sponsor_companies" from "service_role";

revoke truncate on table "public"."sponsor_companies" from "service_role";

revoke update on table "public"."sponsor_companies" from "service_role";

revoke delete on table "public"."sponsor_company_options" from "anon";

revoke insert on table "public"."sponsor_company_options" from "anon";

revoke references on table "public"."sponsor_company_options" from "anon";

revoke select on table "public"."sponsor_company_options" from "anon";

revoke trigger on table "public"."sponsor_company_options" from "anon";

revoke truncate on table "public"."sponsor_company_options" from "anon";

revoke update on table "public"."sponsor_company_options" from "anon";

revoke delete on table "public"."sponsor_company_options" from "authenticated";

revoke insert on table "public"."sponsor_company_options" from "authenticated";

revoke references on table "public"."sponsor_company_options" from "authenticated";

revoke select on table "public"."sponsor_company_options" from "authenticated";

revoke trigger on table "public"."sponsor_company_options" from "authenticated";

revoke truncate on table "public"."sponsor_company_options" from "authenticated";

revoke update on table "public"."sponsor_company_options" from "authenticated";

revoke delete on table "public"."sponsor_company_options" from "service_role";

revoke insert on table "public"."sponsor_company_options" from "service_role";

revoke references on table "public"."sponsor_company_options" from "service_role";

revoke select on table "public"."sponsor_company_options" from "service_role";

revoke trigger on table "public"."sponsor_company_options" from "service_role";

revoke truncate on table "public"."sponsor_company_options" from "service_role";

revoke update on table "public"."sponsor_company_options" from "service_role";

revoke delete on table "public"."sponsor_individuals" from "anon";

revoke insert on table "public"."sponsor_individuals" from "anon";

revoke references on table "public"."sponsor_individuals" from "anon";

revoke select on table "public"."sponsor_individuals" from "anon";

revoke trigger on table "public"."sponsor_individuals" from "anon";

revoke truncate on table "public"."sponsor_individuals" from "anon";

revoke update on table "public"."sponsor_individuals" from "anon";

revoke delete on table "public"."sponsor_individuals" from "authenticated";

revoke insert on table "public"."sponsor_individuals" from "authenticated";

revoke references on table "public"."sponsor_individuals" from "authenticated";

revoke select on table "public"."sponsor_individuals" from "authenticated";

revoke trigger on table "public"."sponsor_individuals" from "authenticated";

revoke truncate on table "public"."sponsor_individuals" from "authenticated";

revoke update on table "public"."sponsor_individuals" from "authenticated";

revoke delete on table "public"."sponsor_individuals" from "service_role";

revoke insert on table "public"."sponsor_individuals" from "service_role";

revoke references on table "public"."sponsor_individuals" from "service_role";

revoke select on table "public"."sponsor_individuals" from "service_role";

revoke trigger on table "public"."sponsor_individuals" from "service_role";

revoke truncate on table "public"."sponsor_individuals" from "service_role";

revoke update on table "public"."sponsor_individuals" from "service_role";

revoke delete on table "public"."staff_member_sns_links" from "anon";

revoke insert on table "public"."staff_member_sns_links" from "anon";

revoke references on table "public"."staff_member_sns_links" from "anon";

revoke select on table "public"."staff_member_sns_links" from "anon";

revoke trigger on table "public"."staff_member_sns_links" from "anon";

revoke truncate on table "public"."staff_member_sns_links" from "anon";

revoke update on table "public"."staff_member_sns_links" from "anon";

revoke delete on table "public"."staff_member_sns_links" from "authenticated";

revoke insert on table "public"."staff_member_sns_links" from "authenticated";

revoke references on table "public"."staff_member_sns_links" from "authenticated";

revoke select on table "public"."staff_member_sns_links" from "authenticated";

revoke trigger on table "public"."staff_member_sns_links" from "authenticated";

revoke truncate on table "public"."staff_member_sns_links" from "authenticated";

revoke update on table "public"."staff_member_sns_links" from "authenticated";

revoke delete on table "public"."staff_member_sns_links" from "service_role";

revoke insert on table "public"."staff_member_sns_links" from "service_role";

revoke references on table "public"."staff_member_sns_links" from "service_role";

revoke select on table "public"."staff_member_sns_links" from "service_role";

revoke trigger on table "public"."staff_member_sns_links" from "service_role";

revoke truncate on table "public"."staff_member_sns_links" from "service_role";

revoke update on table "public"."staff_member_sns_links" from "service_role";

revoke delete on table "public"."staff_members" from "anon";

revoke insert on table "public"."staff_members" from "anon";

revoke references on table "public"."staff_members" from "anon";

revoke select on table "public"."staff_members" from "anon";

revoke trigger on table "public"."staff_members" from "anon";

revoke truncate on table "public"."staff_members" from "anon";

revoke update on table "public"."staff_members" from "anon";

revoke delete on table "public"."staff_members" from "authenticated";

revoke insert on table "public"."staff_members" from "authenticated";

revoke references on table "public"."staff_members" from "authenticated";

revoke select on table "public"."staff_members" from "authenticated";

revoke trigger on table "public"."staff_members" from "authenticated";

revoke truncate on table "public"."staff_members" from "authenticated";

revoke update on table "public"."staff_members" from "authenticated";

revoke delete on table "public"."staff_members" from "service_role";

revoke insert on table "public"."staff_members" from "service_role";

revoke references on table "public"."staff_members" from "service_role";

revoke select on table "public"."staff_members" from "service_role";

revoke trigger on table "public"."staff_members" from "service_role";

revoke truncate on table "public"."staff_members" from "service_role";

revoke update on table "public"."staff_members" from "service_role";

revoke delete on table "public"."stripe_webhook_logs" from "anon";

revoke insert on table "public"."stripe_webhook_logs" from "anon";

revoke references on table "public"."stripe_webhook_logs" from "anon";

revoke select on table "public"."stripe_webhook_logs" from "anon";

revoke trigger on table "public"."stripe_webhook_logs" from "anon";

revoke truncate on table "public"."stripe_webhook_logs" from "anon";

revoke update on table "public"."stripe_webhook_logs" from "anon";

revoke delete on table "public"."stripe_webhook_logs" from "authenticated";

revoke insert on table "public"."stripe_webhook_logs" from "authenticated";

revoke references on table "public"."stripe_webhook_logs" from "authenticated";

revoke select on table "public"."stripe_webhook_logs" from "authenticated";

revoke trigger on table "public"."stripe_webhook_logs" from "authenticated";

revoke truncate on table "public"."stripe_webhook_logs" from "authenticated";

revoke update on table "public"."stripe_webhook_logs" from "authenticated";

revoke delete on table "public"."stripe_webhook_logs" from "service_role";

revoke insert on table "public"."stripe_webhook_logs" from "service_role";

revoke references on table "public"."stripe_webhook_logs" from "service_role";

revoke select on table "public"."stripe_webhook_logs" from "service_role";

revoke trigger on table "public"."stripe_webhook_logs" from "service_role";

revoke truncate on table "public"."stripe_webhook_logs" from "service_role";

revoke update on table "public"."stripe_webhook_logs" from "service_role";

revoke delete on table "public"."ticket_checkout_options" from "anon";

revoke insert on table "public"."ticket_checkout_options" from "anon";

revoke references on table "public"."ticket_checkout_options" from "anon";

revoke select on table "public"."ticket_checkout_options" from "anon";

revoke trigger on table "public"."ticket_checkout_options" from "anon";

revoke truncate on table "public"."ticket_checkout_options" from "anon";

revoke update on table "public"."ticket_checkout_options" from "anon";

revoke delete on table "public"."ticket_checkout_options" from "authenticated";

revoke insert on table "public"."ticket_checkout_options" from "authenticated";

revoke references on table "public"."ticket_checkout_options" from "authenticated";

revoke select on table "public"."ticket_checkout_options" from "authenticated";

revoke trigger on table "public"."ticket_checkout_options" from "authenticated";

revoke truncate on table "public"."ticket_checkout_options" from "authenticated";

revoke update on table "public"."ticket_checkout_options" from "authenticated";

revoke delete on table "public"."ticket_checkout_options" from "service_role";

revoke insert on table "public"."ticket_checkout_options" from "service_role";

revoke references on table "public"."ticket_checkout_options" from "service_role";

revoke select on table "public"."ticket_checkout_options" from "service_role";

revoke trigger on table "public"."ticket_checkout_options" from "service_role";

revoke truncate on table "public"."ticket_checkout_options" from "service_role";

revoke update on table "public"."ticket_checkout_options" from "service_role";

revoke delete on table "public"."ticket_checkout_sessions" from "anon";

revoke insert on table "public"."ticket_checkout_sessions" from "anon";

revoke references on table "public"."ticket_checkout_sessions" from "anon";

revoke select on table "public"."ticket_checkout_sessions" from "anon";

revoke trigger on table "public"."ticket_checkout_sessions" from "anon";

revoke truncate on table "public"."ticket_checkout_sessions" from "anon";

revoke update on table "public"."ticket_checkout_sessions" from "anon";

revoke delete on table "public"."ticket_checkout_sessions" from "authenticated";

revoke insert on table "public"."ticket_checkout_sessions" from "authenticated";

revoke references on table "public"."ticket_checkout_sessions" from "authenticated";

revoke select on table "public"."ticket_checkout_sessions" from "authenticated";

revoke trigger on table "public"."ticket_checkout_sessions" from "authenticated";

revoke truncate on table "public"."ticket_checkout_sessions" from "authenticated";

revoke update on table "public"."ticket_checkout_sessions" from "authenticated";

revoke delete on table "public"."ticket_checkout_sessions" from "service_role";

revoke insert on table "public"."ticket_checkout_sessions" from "service_role";

revoke references on table "public"."ticket_checkout_sessions" from "service_role";

revoke select on table "public"."ticket_checkout_sessions" from "service_role";

revoke trigger on table "public"."ticket_checkout_sessions" from "service_role";

revoke truncate on table "public"."ticket_checkout_sessions" from "service_role";

revoke update on table "public"."ticket_checkout_sessions" from "service_role";

revoke delete on table "public"."ticket_options" from "anon";

revoke insert on table "public"."ticket_options" from "anon";

revoke references on table "public"."ticket_options" from "anon";

revoke select on table "public"."ticket_options" from "anon";

revoke trigger on table "public"."ticket_options" from "anon";

revoke truncate on table "public"."ticket_options" from "anon";

revoke update on table "public"."ticket_options" from "anon";

revoke delete on table "public"."ticket_options" from "authenticated";

revoke insert on table "public"."ticket_options" from "authenticated";

revoke references on table "public"."ticket_options" from "authenticated";

revoke select on table "public"."ticket_options" from "authenticated";

revoke trigger on table "public"."ticket_options" from "authenticated";

revoke truncate on table "public"."ticket_options" from "authenticated";

revoke update on table "public"."ticket_options" from "authenticated";

revoke delete on table "public"."ticket_options" from "service_role";

revoke insert on table "public"."ticket_options" from "service_role";

revoke references on table "public"."ticket_options" from "service_role";

revoke select on table "public"."ticket_options" from "service_role";

revoke trigger on table "public"."ticket_options" from "service_role";

revoke truncate on table "public"."ticket_options" from "service_role";

revoke update on table "public"."ticket_options" from "service_role";

revoke delete on table "public"."ticket_purchase_options" from "anon";

revoke insert on table "public"."ticket_purchase_options" from "anon";

revoke references on table "public"."ticket_purchase_options" from "anon";

revoke select on table "public"."ticket_purchase_options" from "anon";

revoke trigger on table "public"."ticket_purchase_options" from "anon";

revoke truncate on table "public"."ticket_purchase_options" from "anon";

revoke update on table "public"."ticket_purchase_options" from "anon";

revoke delete on table "public"."ticket_purchase_options" from "authenticated";

revoke insert on table "public"."ticket_purchase_options" from "authenticated";

revoke references on table "public"."ticket_purchase_options" from "authenticated";

revoke select on table "public"."ticket_purchase_options" from "authenticated";

revoke trigger on table "public"."ticket_purchase_options" from "authenticated";

revoke truncate on table "public"."ticket_purchase_options" from "authenticated";

revoke update on table "public"."ticket_purchase_options" from "authenticated";

revoke delete on table "public"."ticket_purchase_options" from "service_role";

revoke insert on table "public"."ticket_purchase_options" from "service_role";

revoke references on table "public"."ticket_purchase_options" from "service_role";

revoke select on table "public"."ticket_purchase_options" from "service_role";

revoke trigger on table "public"."ticket_purchase_options" from "service_role";

revoke truncate on table "public"."ticket_purchase_options" from "service_role";

revoke update on table "public"."ticket_purchase_options" from "service_role";

revoke delete on table "public"."ticket_purchases" from "anon";

revoke insert on table "public"."ticket_purchases" from "anon";

revoke references on table "public"."ticket_purchases" from "anon";

revoke select on table "public"."ticket_purchases" from "anon";

revoke trigger on table "public"."ticket_purchases" from "anon";

revoke truncate on table "public"."ticket_purchases" from "anon";

revoke update on table "public"."ticket_purchases" from "anon";

revoke delete on table "public"."ticket_purchases" from "authenticated";

revoke insert on table "public"."ticket_purchases" from "authenticated";

revoke references on table "public"."ticket_purchases" from "authenticated";

revoke select on table "public"."ticket_purchases" from "authenticated";

revoke trigger on table "public"."ticket_purchases" from "authenticated";

revoke truncate on table "public"."ticket_purchases" from "authenticated";

revoke update on table "public"."ticket_purchases" from "authenticated";

revoke delete on table "public"."ticket_purchases" from "service_role";

revoke insert on table "public"."ticket_purchases" from "service_role";

revoke references on table "public"."ticket_purchases" from "service_role";

revoke select on table "public"."ticket_purchases" from "service_role";

revoke trigger on table "public"."ticket_purchases" from "service_role";

revoke truncate on table "public"."ticket_purchases" from "service_role";

revoke update on table "public"."ticket_purchases" from "service_role";

revoke delete on table "public"."ticket_types" from "anon";

revoke insert on table "public"."ticket_types" from "anon";

revoke references on table "public"."ticket_types" from "anon";

revoke select on table "public"."ticket_types" from "anon";

revoke trigger on table "public"."ticket_types" from "anon";

revoke truncate on table "public"."ticket_types" from "anon";

revoke update on table "public"."ticket_types" from "anon";

revoke delete on table "public"."ticket_types" from "authenticated";

revoke insert on table "public"."ticket_types" from "authenticated";

revoke references on table "public"."ticket_types" from "authenticated";

revoke select on table "public"."ticket_types" from "authenticated";

revoke trigger on table "public"."ticket_types" from "authenticated";

revoke truncate on table "public"."ticket_types" from "authenticated";

revoke update on table "public"."ticket_types" from "authenticated";

revoke delete on table "public"."ticket_types" from "service_role";

revoke insert on table "public"."ticket_types" from "service_role";

revoke references on table "public"."ticket_types" from "service_role";

revoke select on table "public"."ticket_types" from "service_role";

revoke trigger on table "public"."ticket_types" from "service_role";

revoke truncate on table "public"."ticket_types" from "service_role";

revoke update on table "public"."ticket_types" from "service_role";

revoke delete on table "public"."timeline_events" from "anon";

revoke insert on table "public"."timeline_events" from "anon";

revoke references on table "public"."timeline_events" from "anon";

revoke select on table "public"."timeline_events" from "anon";

revoke trigger on table "public"."timeline_events" from "anon";

revoke truncate on table "public"."timeline_events" from "anon";

revoke update on table "public"."timeline_events" from "anon";

revoke delete on table "public"."timeline_events" from "authenticated";

revoke insert on table "public"."timeline_events" from "authenticated";

revoke references on table "public"."timeline_events" from "authenticated";

revoke select on table "public"."timeline_events" from "authenticated";

revoke trigger on table "public"."timeline_events" from "authenticated";

revoke truncate on table "public"."timeline_events" from "authenticated";

revoke update on table "public"."timeline_events" from "authenticated";

revoke delete on table "public"."timeline_events" from "service_role";

revoke insert on table "public"."timeline_events" from "service_role";

revoke references on table "public"."timeline_events" from "service_role";

revoke select on table "public"."timeline_events" from "service_role";

revoke trigger on table "public"."timeline_events" from "service_role";

revoke truncate on table "public"."timeline_events" from "service_role";

revoke update on table "public"."timeline_events" from "service_role";

revoke delete on table "public"."user_roles" from "anon";

revoke insert on table "public"."user_roles" from "anon";

revoke references on table "public"."user_roles" from "anon";

revoke select on table "public"."user_roles" from "anon";

revoke trigger on table "public"."user_roles" from "anon";

revoke truncate on table "public"."user_roles" from "anon";

revoke update on table "public"."user_roles" from "anon";

revoke delete on table "public"."user_roles" from "authenticated";

revoke insert on table "public"."user_roles" from "authenticated";

revoke references on table "public"."user_roles" from "authenticated";

revoke select on table "public"."user_roles" from "authenticated";

revoke trigger on table "public"."user_roles" from "authenticated";

revoke truncate on table "public"."user_roles" from "authenticated";

revoke update on table "public"."user_roles" from "authenticated";

revoke delete on table "public"."user_roles" from "service_role";

revoke insert on table "public"."user_roles" from "service_role";

revoke references on table "public"."user_roles" from "service_role";

revoke select on table "public"."user_roles" from "service_role";

revoke trigger on table "public"."user_roles" from "service_role";

revoke truncate on table "public"."user_roles" from "service_role";

revoke update on table "public"."user_roles" from "service_role";

revoke delete on table "public"."user_sns_links" from "anon";

revoke insert on table "public"."user_sns_links" from "anon";

revoke references on table "public"."user_sns_links" from "anon";

revoke select on table "public"."user_sns_links" from "anon";

revoke trigger on table "public"."user_sns_links" from "anon";

revoke truncate on table "public"."user_sns_links" from "anon";

revoke update on table "public"."user_sns_links" from "anon";

revoke delete on table "public"."user_sns_links" from "authenticated";

revoke insert on table "public"."user_sns_links" from "authenticated";

revoke references on table "public"."user_sns_links" from "authenticated";

revoke select on table "public"."user_sns_links" from "authenticated";

revoke trigger on table "public"."user_sns_links" from "authenticated";

revoke truncate on table "public"."user_sns_links" from "authenticated";

revoke update on table "public"."user_sns_links" from "authenticated";

revoke delete on table "public"."user_sns_links" from "service_role";

revoke insert on table "public"."user_sns_links" from "service_role";

revoke references on table "public"."user_sns_links" from "service_role";

revoke select on table "public"."user_sns_links" from "service_role";

revoke trigger on table "public"."user_sns_links" from "service_role";

revoke truncate on table "public"."user_sns_links" from "service_role";

revoke update on table "public"."user_sns_links" from "service_role";

revoke delete on table "public"."users" from "anon";

revoke insert on table "public"."users" from "anon";

revoke references on table "public"."users" from "anon";

revoke select on table "public"."users" from "anon";

revoke trigger on table "public"."users" from "anon";

revoke truncate on table "public"."users" from "anon";

revoke update on table "public"."users" from "anon";

revoke delete on table "public"."users" from "authenticated";

revoke insert on table "public"."users" from "authenticated";

revoke references on table "public"."users" from "authenticated";

revoke select on table "public"."users" from "authenticated";

revoke trigger on table "public"."users" from "authenticated";

revoke truncate on table "public"."users" from "authenticated";

revoke update on table "public"."users" from "authenticated";

revoke delete on table "public"."users" from "service_role";

revoke insert on table "public"."users" from "service_role";

revoke references on table "public"."users" from "service_role";

revoke select on table "public"."users" from "service_role";

revoke trigger on table "public"."users" from "service_role";

revoke truncate on table "public"."users" from "service_role";

revoke update on table "public"."users" from "service_role";

drop view if exists "public"."session_venues_with_sessions";

drop view if exists "public"."sponsor_with_sessions";

drop view if exists "public"."v_ticket_counts";

drop view if exists "public"."v_ticket_option_counts";

alter table "public"."session_venues" alter column "id" set default extensions.uuid_generate_v4();

alter table "public"."sessions" drop column "url";

alter table "public"."sessions" alter column "id" set default extensions.uuid_generate_v4();

alter table "public"."speakers" alter column "id" set default extensions.uuid_generate_v4();

alter table "public"."ticket_purchases" alter column "nameplate_id" set data type text using "nameplate_id"::text;

alter table "public"."timeline_events" drop column "url";

alter table "public"."timeline_events" alter column "id" set default extensions.uuid_generate_v4();

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.check_option_plan_availability(p_basic_plan_type basic_plan_type, p_option_plan_type option_plan_type)
 RETURNS boolean
 LANGUAGE plpgsql
AS $function$
BEGIN
  -- 
  IF p_option_plan_type = 'scholarship' THEN
    RETURN TRUE;
  END IF;
  
  -- silver
  IF p_option_plan_type = 'naming_rights_hall' THEN
    RETURN p_basic_plan_type IN ('platinum', 'gold', 'silver');
  END IF;
  
  -- silver
  IF p_option_plan_type = 'naming_rights_room' THEN
    RETURN p_basic_plan_type IN ('platinum', 'gold', 'silver');
  END IF;
  
  -- 
  IF p_option_plan_type = 'nameplate' THEN
    RETURN p_basic_plan_type IN ('platinum', 'gold', 'silver', 'bronze');
  END IF;
  
  -- 
  IF p_option_plan_type = 'lunch' THEN
    RETURN p_basic_plan_type IN ('silver', 'bronze');
  END IF;
  
  RETURN FALSE;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.check_sponsor_option_constraint()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
DECLARE
  v_basic_plan_type public.basic_plan_type;
  v_sponsor_type public.company_sponsor_type;
BEGIN
  -- 
  SELECT sc.sponsor_type
  INTO v_sponsor_type
  FROM sponsor_companies sc
  WHERE sc.id = NEW.sponsor_company_id;

  IF v_sponsor_type != 'basic' THEN
    IF NEW.option_plan_type != 'scholarship' THEN
      RAISE EXCEPTION '';
    END IF;
    RETURN NEW;
  END IF;

  -- 
  SELECT bsc.basic_plan_type
  INTO v_basic_plan_type
  FROM basic_sponsor_companies bsc
  WHERE bsc.sponsor_company_id = NEW.sponsor_company_id;

  IF NOT check_option_plan_availability(v_basic_plan_type, NEW.option_plan_type) THEN
    RAISE EXCEPTION '';
  END IF;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.create_ticket_checkout(user_id uuid, ticket_type_id text, ticket_option_ids text[], stripe_checkout_session_id text, stripe_checkout_url text)
 RETURNS uuid
 LANGUAGE plpgsql
AS $function$
DECLARE
  v_checkout_session_id uuid;
  v_ticket_type_record record;
  v_option_record record;
  v_option_id text;
  v_sold_count integer;
  v_reserved_count integer;
  v_total_count integer;
BEGIN
  -- 
  SELECT *
  INTO v_ticket_type_record
  FROM public.ticket_types
  WHERE id = ticket_type_id AND is_active = true;

  IF NOT FOUND THEN
    RAISE EXCEPTION ': %', ticket_type_id;
  END IF;

  -- 
  IF v_ticket_type_record.sale_starts_at IS NOT NULL AND now() < v_ticket_type_record.sale_starts_at THEN
    RAISE EXCEPTION '';
  END IF;

  IF v_ticket_type_record.sale_ends_at IS NOT NULL AND now() > v_ticket_type_record.sale_ends_at THEN
    RAISE EXCEPTION '';
  END IF;

  -- 
  IF ticket_option_ids IS NOT NULL THEN
    FOREACH v_option_id IN ARRAY ticket_option_ids
    LOOP
      IF NOT EXISTS (
        SELECT 1 FROM public.ticket_options
        WHERE id = v_option_id AND ticket_type_id = create_ticket_checkout.ticket_type_id
      ) THEN
        RAISE EXCEPTION ': %', v_option_id;
      END IF;
    END LOOP;
  END IF;

  -- 
  SELECT sold_count, reserved_count INTO v_sold_count, v_reserved_count
  FROM v_ticket_counts
  WHERE ticket_type_id = create_ticket_checkout.ticket_type_id;

  v_total_count := v_sold_count + v_reserved_count;

  IF v_ticket_type_record.max_quantity IS NOT NULL AND v_total_count >= v_ticket_type_record.max_quantity THEN
    RAISE EXCEPTION ': %, : %, : %',
      v_sold_count, v_reserved_count, v_ticket_type_record.max_quantity;
  END IF;

      -- 
  IF ticket_option_ids IS NOT NULL THEN
    FOREACH v_option_id IN ARRAY ticket_option_ids
    LOOP
      -- 
      SELECT *
      INTO v_option_record
      FROM public.ticket_options
      WHERE id = v_option_id;

      -- max_quantity
      IF v_option_record.max_quantity IS NOT NULL THEN
        -- 
        SELECT sold_count, reserved_count INTO v_sold_count, v_reserved_count
        FROM v_ticket_option_counts
        WHERE ticket_option_id = v_option_id;

        v_total_count := v_sold_count + v_reserved_count;

        IF v_total_count >= v_option_record.max_quantity THEN
          RAISE EXCEPTION ' % : %, : %, : %',
            v_option_id, v_sold_count, v_reserved_count, v_option_record.max_quantity;
        END IF;
      END IF;
    END LOOP;
  END IF;

  -- 
  INSERT INTO public.ticket_checkout_sessions (
    user_id,
    ticket_type_id,
    status,
    stripe_checkout_session_id,
    stripe_checkout_url,
    expires_at
  ) VALUES (
    create_ticket_checkout.user_id,
    create_ticket_checkout.ticket_type_id,
    'pending',
    create_ticket_checkout.stripe_checkout_session_id,
    create_ticket_checkout.stripe_checkout_url,
    now() + interval '10 minutes'
  ) RETURNING id INTO v_checkout_session_id;

  -- 
  IF ticket_option_ids IS NOT NULL THEN
    FOREACH v_option_id IN ARRAY ticket_option_ids
    LOOP
      INSERT INTO public.ticket_checkout_options (
        checkout_session_id,
        ticket_option_id
      ) VALUES (
        v_checkout_session_id,
        v_option_id
      );
    END LOOP;
  END IF;

  RETURN v_checkout_session_id;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_new_user()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
begin
  insert into public.users (id)
  values (new.id);
  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.replace_user_roles(p_user_id uuid, p_roles role[])
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
  DELETE FROM public.user_roles WHERE user_id = p_user_id;

  IF array_length(p_roles, 1) IS NOT NULL THEN
    INSERT INTO public.user_roles (user_id, role)
    SELECT p_user_id, unnest(p_roles);
  END IF;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.replace_user_sns_links(user_id uuid, sns_accounts jsonb)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
  -- SNS
  DELETE FROM public.user_sns_links WHERE user_sns_links.user_id = replace_user_sns_links.user_id;

  -- SNS
  -- sns_accountsnull
  IF sns_accounts IS NOT NULL AND jsonb_typeof(sns_accounts) = 'array' AND jsonb_array_length(sns_accounts) > 0 THEN
    INSERT INTO public.user_sns_links (user_id, sns_type, value, created_at, updated_at)
    SELECT
      replace_user_sns_links.user_id,
      CAST(j->>'type' AS public.sns_type),
      trim(j->>'value'),
      current_timestamp,
      current_timestamp
    FROM jsonb_array_elements(sns_accounts) AS j
    WHERE trim(j->>'value') != '';
  END IF;
END;
$function$
;

create or replace view "public"."session_venues_with_sessions" as  SELECT sv.id,
    sv.name,
    COALESCE(( SELECT json_agg(json_build_object('id', s.id, 'title', s.title, 'description', s.description, 'starts_at', s.starts_at, 'ends_at', s.ends_at, 'is_lightning_talk', s.is_lightning_talk, 'is_beginners_lightning_talk', s.is_beginners_lightning_talk, 'is_hands_on', s.is_hands_on, 'video_url', s.video_url, 'speakers', COALESCE(( SELECT json_agg(json_build_object('id', sp.id, 'name', sp.name, 'avatar_url', sp.avatar_url, 'x_id', sp.x_id)) AS json_agg
                   FROM (session_speakers ss
                     JOIN speakers sp ON ((ss.speaker_id = sp.id)))
                  WHERE (ss.session_id = s.id)), '[]'::json), 'sponsor',
                CASE
                    WHEN (s.sponsor_id IS NOT NULL) THEN ( SELECT json_build_object('id', c.id, 'name', c.name, 'logo_url', c.logo_name, 'slug', cd.slug, 'pr_text', cd.pr_text, 'website_url', cd.website_url, 'sponsor_type', sc.sponsor_type, 'display_order', sc.display_order, 'basic_plan_type', bsc.basic_plan_type, 'option_plan_types', COALESCE(array_agg((sco.option_plan_type)::text) FILTER (WHERE (sco.option_plan_type IS NOT NULL)), ARRAY[]::text[])) AS json_build_object
                       FROM (((((companies c
                         JOIN sponsor_companies sc ON ((c.id = sc.company_id)))
                         LEFT JOIN basic_sponsor_companies bsc ON ((sc.id = bsc.sponsor_company_id)))
                         LEFT JOIN company_drafts cd ON ((c.id = cd.company_id)))
                         LEFT JOIN company_draft_approvals cda ON ((cd.id = cda.company_draft_id)))
                         LEFT JOIN sponsor_company_options sco ON ((sc.id = sco.sponsor_company_id)))
                      WHERE (sc.id = s.sponsor_id)
                      GROUP BY c.id, c.name, c.logo_name, cd.slug, cd.pr_text, cd.website_url, sc.sponsor_type, sc.display_order, bsc.basic_plan_type)
                    ELSE NULL::json
                END) ORDER BY s.starts_at) AS json_agg
           FROM sessions s
          WHERE (s.venue_id = sv.id)), '[]'::json) AS sessions
   FROM session_venues sv
  ORDER BY sv.name;


create or replace view "public"."sponsor_with_sessions" as  SELECT json_build_object('id', c.id, 'name', c.name, 'logo_url', c.logo_name, 'slug', cd.slug, 'pr_text', cd.pr_text, 'website_url', cd.website_url, 'sponsor_type', sc.sponsor_type, 'display_order', sc.display_order, 'basic_plan_type', bsc.basic_plan_type, 'option_plan_types', COALESCE(array_agg(DISTINCT (sco.option_plan_type)::text) FILTER (WHERE (sco.option_plan_type IS NOT NULL)), ARRAY[]::text[])) AS sponsor,
    COALESCE(( SELECT json_agg(json_build_object('id', s.id, 'title', s.title, 'description', s.description, 'starts_at', s.starts_at, 'ends_at', s.ends_at, 'is_lightning_talk', s.is_lightning_talk, 'is_beginners_lightning_talk', s.is_beginners_lightning_talk, 'is_hands_on', s.is_hands_on, 'video_url', s.video_url, 'venue', json_build_object('id', sv.id, 'name', sv.name), 'speakers', COALESCE(( SELECT json_agg(json_build_object('id', sp.id, 'name', sp.name, 'avatar_url', sp.avatar_url, 'x_id', sp.x_id)) AS json_agg
                   FROM (session_speakers ss
                     JOIN speakers sp ON ((ss.speaker_id = sp.id)))
                  WHERE (ss.session_id = s.id)), '[]'::json)) ORDER BY s.starts_at) AS json_agg
           FROM (sessions s
             JOIN session_venues sv ON ((s.venue_id = sv.id)))
          WHERE (s.sponsor_id = sc.id)), '[]'::json) AS sessions
   FROM (((((sponsor_companies sc
     JOIN companies c ON ((sc.company_id = c.id)))
     LEFT JOIN basic_sponsor_companies bsc ON ((sc.id = bsc.sponsor_company_id)))
     LEFT JOIN company_drafts cd ON ((c.id = cd.company_id)))
     LEFT JOIN company_draft_approvals cda ON ((cd.id = cda.company_draft_id)))
     LEFT JOIN sponsor_company_options sco ON ((sc.id = sco.sponsor_company_id)))
  WHERE (cda.id IS NOT NULL)
  GROUP BY c.id, c.name, c.logo_name, cd.slug, cd.pr_text, cd.website_url, sc.sponsor_type, sc.display_order, bsc.basic_plan_type, sc.id
 HAVING (EXISTS ( SELECT 1
           FROM sessions s
          WHERE (s.sponsor_id = sc.id)))
  ORDER BY sc.display_order;


CREATE OR REPLACE FUNCTION public.update_updated_at_column()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  NEW.updated_at = current_timestamp;
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.upsert_user_roles(p_user_id uuid, roles role[])
 RETURNS users
 LANGUAGE plpgsql
AS $function$
DECLARE
  result public.users;
BEGIN
  DELETE FROM public.user_roles AS ur WHERE ur.user_id = p_user_id;
  INSERT INTO public.user_roles (user_id, role) VALUES
    (p_user_id, unnest(roles));

  SELECT
    u.*,
    json_agg(ur.role) AS roles
  FROM
    public.users AS u
    LEFT JOIN public.user_roles AS ur ON u.id = ur.user_id
  WHERE
    u.id = $1
  GROUP BY u.id
  INTO result;
  RETURN result;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.uuid_generate_v7()
 RETURNS uuid
 LANGUAGE plpgsql
AS $function$
BEGIN
    return encode(set_bit(set_bit(overlay(
        uuid_send(gen_random_uuid())
        placing substring(int8send(floor(extract(epoch from clock_timestamp()) * 1000)::bigint) from 3)
        from 1 for 6
    ), 52, 1), 53, 1), 'hex')::uuid;
END
$function$
;

create or replace view "public"."v_ticket_counts" as  SELECT tt.id AS ticket_type_id,
    COALESCE(tp_counts.sold_count, 0) AS sold_count,
    COALESCE(tcs_counts.reserved_count, 0) AS reserved_count
   FROM ((ticket_types tt
     LEFT JOIN ( SELECT tp.ticket_type_id,
            (count(*))::integer AS sold_count
           FROM ticket_purchases tp
          GROUP BY tp.ticket_type_id) tp_counts ON ((tt.id = tp_counts.ticket_type_id)))
     LEFT JOIN ( SELECT tcs.ticket_type_id,
            (count(*))::integer AS reserved_count
           FROM ticket_checkout_sessions tcs
          WHERE ((tcs.status = 'pending'::ticket_checkout_status) AND (tcs.expires_at > now()))
          GROUP BY tcs.ticket_type_id) tcs_counts ON ((tt.id = tcs_counts.ticket_type_id)));


create or replace view "public"."v_ticket_option_counts" as  SELECT topt.id AS ticket_option_id,
    topt.ticket_type_id,
    COALESCE(tpo_counts.sold_count, 0) AS sold_count,
    COALESCE(tco_counts.reserved_count, 0) AS reserved_count
   FROM ((ticket_options topt
     LEFT JOIN ( SELECT tpo.ticket_option_id,
            (count(*))::integer AS sold_count
           FROM (ticket_purchase_options tpo
             JOIN ticket_purchases tp ON ((tpo.ticket_purchase_id = tp.id)))
          GROUP BY tpo.ticket_option_id) tpo_counts ON ((topt.id = tpo_counts.ticket_option_id)))
     LEFT JOIN ( SELECT tco.ticket_option_id,
            (count(*))::integer AS reserved_count
           FROM (ticket_checkout_options tco
             JOIN ticket_checkout_sessions tcs ON ((tco.checkout_session_id = tcs.id)))
          WHERE ((tcs.status = 'pending'::ticket_checkout_status) AND (tcs.expires_at > now()))
          GROUP BY tco.ticket_option_id) tco_counts ON ((topt.id = tco_counts.ticket_option_id)));


create policy "session_speakers_admin_write"
on "public"."session_speakers"
as permissive
for all
to authenticated
using ((EXISTS ( SELECT 1
   FROM user_roles
  WHERE ((user_roles.user_id = auth.uid()) AND (user_roles.role = 'admin'::role)))));


create policy "session_speakers_read_all"
on "public"."session_speakers"
as permissive
for select
to public
using (true);


create policy "session_venues_admin_write"
on "public"."session_venues"
as permissive
for all
to authenticated
using ((EXISTS ( SELECT 1
   FROM user_roles
  WHERE ((user_roles.user_id = auth.uid()) AND (user_roles.role = 'admin'::role)))));


create policy "session_venues_read_all"
on "public"."session_venues"
as permissive
for select
to public
using (true);


create policy "sessions_admin_write"
on "public"."sessions"
as permissive
for all
to authenticated
using ((EXISTS ( SELECT 1
   FROM user_roles
  WHERE ((user_roles.user_id = auth.uid()) AND (user_roles.role = 'admin'::role)))));


create policy "sessions_read_all"
on "public"."sessions"
as permissive
for select
to public
using (true);


create policy "speakers_admin_write"
on "public"."speakers"
as permissive
for all
to authenticated
using ((EXISTS ( SELECT 1
   FROM user_roles
  WHERE ((user_roles.user_id = auth.uid()) AND (user_roles.role = 'admin'::role)))));


create policy "speakers_read_all"
on "public"."speakers"
as permissive
for select
to public
using (true);




